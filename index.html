<!DOCTYPE html>

<html lang="pt-br">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Gerador de Comunicado Interno</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>

  <style>

    body {

      font-family: Arial, sans-serif;

      margin: 20px;

    }

    input, textarea, select {

      width: 100%;

      padding: 8px;

      margin: 5px 0 15px;

    }

    label {

      font-weight: bold;

    }

    .container {

      max-width: 800px;

      margin: auto;

    }

    .btn {

      padding: 10px 15px;

      background-color: #007BFF;

      color: white;

      border: none;

      cursor: pointer;

    }

    .btn:hover {

      background-color: #0056b3;

    }

    #editor {

      margin-bottom: 15px;

    }

    #preview {

      display: none;

    }

  </style>

</head>

<body>

  <div class="container">

    <h1>Gerador de Comunicado Interno</h1>



    <label>Órgão</label>

    <input type="text" id="orgao" value="Autarquia Municipal de Trânsito e Cidadania - AMC" readonly>



    <label>Setor</label>

    <input type="text" id="setor" value="Diretoria Administrativo Financeira – DIAFI" readonly>



    <label>Número da CI</label>

    <input type="text" id="numero" readonly>



    <label>Destino</label>

    <select id="destino">

      <option value="PROJUR AMC">PROJUR AMC</option>

      <option value="SETINF AMC">SETINF AMC</option>

      <option value="DICON AMC">DICON AMC</option>

      <option value="DIRAD AMC">DIRAD AMC</option>

      <option value="GABIN AMC">GABIN AMC</option>

    </select>



    <label>Data</label>

    <input type="date" id="data">



    <label>Assunto</label>

    <input type="text" id="assunto">



    <label>Texto do comunicado (com formatação, alinhamento e tabelas)</label>

    <div id="editor"></div>



    <label>Assinatura 1</label>

    <input type="text" id="assinatura1_nome" placeholder="Nome">

    <input type="text" id="assinatura1_cargo" placeholder="Cargo">



    <label>Assinatura 2</label>

    <input type="text" id="assinatura2_nome" placeholder="Nome">

    <input type="text" id="assinatura2_cargo" placeholder="Cargo">



    <button class="btn" onclick="gerarPDF()">Visualizar/Gerar PDF</button>



    <div id="preview"></div>

  </div>



  <script>

    let editorInstance;

    ClassicEditor.create(document.querySelector('#editor'), {

      toolbar: [

        'heading', '|', 'bold', 'italic', 'underline', 'link', 'bulletedList', 'numberedList', '|', 'alignment:left', 'alignment:center', 'alignment:right', 'alignment:justify', '|', 'insertTable', '|', 'undo', 'redo'

      ],

      alignment: {

        options: [ 'left', 'center', 'right', 'justify' ]

      },

      table: {

        contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells']

      },

      language: 'pt'

    })

    .then(editor => {

      editorInstance = editor;

    })

    .catch(error => {

      console.error(error);

    });



    window.onload = function () {

      const currentYear = new Date().getFullYear();

      const numeroCI = localStorage.getItem('ci_counter_' + currentYear) || 0;

      const novoNumero = parseInt(numeroCI) + 1;

      document.getElementById('numero').value = `${novoNumero}/${currentYear}`;

      localStorage.setItem('ci_counter_' + currentYear, novoNumero);

    }



    function gerarPDF() {

      const orgao = document.getElementById('orgao').value;

      const setor = document.getElementById('setor').value;

      const numero = document.getElementById('numero').value;

      const destino = document.getElementById('destino').value;

      const data = document.getElementById('data').value;

      const assunto = document.getElementById('assunto').value;

      const textoHTML = editorInstance.getData();

      const assinatura1_nome = document.getElementById('assinatura1_nome').value;

      const assinatura1_cargo = document.getElementById('assinatura1_cargo').value;

      const assinatura2_nome = document.getElementById('assinatura2_nome').value;

      const assinatura2_cargo = document.getElementById('assinatura2_cargo').value;



      const preview = document.getElementById('preview');

      preview.innerHTML = `

        <div style="font-family: Arial; font-size: 12px; padding: 20px; max-width: 800px">

          <p><strong>${orgao}</strong></p>

          <h2 style="text-align:center">COMUNICAÇÃO INTERNA</h2>

          <p><strong>Origem:</strong> ${setor} - CI nº ${numero}</p>

          <p><strong>Destino:</strong> ${destino} &nbsp;&nbsp; <strong>Data:</strong> ${data}</p>

          <p><strong>Assunto:</strong> ${assunto}</p>

          <p><em>Prezada Senhora Procuradora,</em></p>

          <div>${textoHTML}</div>

          <br><br>

          <p><strong>Atenciosamente,</strong><br>${assinatura1_nome}<br>${assinatura1_cargo}</p>

          <br><br>

          <p><strong>Ciente, De acordo:</strong><br>${assinatura2_nome}<br>${assinatura2_cargo}</p>

        </div>

      `;



      html2pdf().from(preview).set({

        margin: 10,

        filename: `comunicado_interno_${numero}.pdf`,

        html2canvas: { scale: 2 },

        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }

      }).outputPdf('dataurlnewwindow');

    }

  </script>

</body>

</html>